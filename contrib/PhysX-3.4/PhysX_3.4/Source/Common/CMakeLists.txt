ADD_DEFINITIONS(-DPX_PHYSX_COMMON_EXPORTS)

FILE(GLOB_RECURSE COMMON_HEADERS ${PHYSX_PATH_SOURCE}/Common/src/*.h ${PHYSX_PATH_SOURCE}/Common/include/*.h ${PHYSX_PATH_SOURCE}/GeomUtils/headers/*.h)
FILE(GLOB_RECURSE COMMON_SOURCES ${PHYSX_PATH_SOURCE}/Common/src/*.cpp ${PHYSX_PATH_SOURCE}/GeomUtils/src/*.cpp)

IF(UNIX OR APPLE OR EMSCRIPTEN)
    LIST(REMOVE_ITEM COMMON_SOURCES "${PROJECT_SOURCE_DIR}/src/PhysX_3.4/Source/Common/src/windows/CmWindowsDelayLoadHook.cpp")
    LIST(REMOVE_ITEM COMMON_SOURCES "${PROJECT_SOURCE_DIR}/src/PhysX_3.4/Source/Common/src/windows/CmWindowsModuleUpdateLoader.cpp")
    LIST(REMOVE_ITEM COMMON_HEADERS "${PROJECT_SOURCE_DIR}/src/PhysX_3.4/Source/Common/include/windows/CmWindowsLoadLibrary.h")
    LIST(REMOVE_ITEM COMMON_HEADERS "${PROJECT_SOURCE_DIR}/src/PhysX_3.4/Source/Common/include/windows/CmWindowsModuleUpdateLoader.h")
ENDIF()

IF(WIN32)
    ADD_DEFINITIONS(-DPX_FOUNDATION_DLL=1)
ELSE()
    ADD_DEFINITIONS(-DPX_PHYSX_STATIC_LIB)
ENDIF()

SOURCE_GROUP("Headers" FILES ${COMMON_HEADERS})
SOURCE_GROUP("Sources" FILES ${COMMON_SOURCES})

IF(WIN32)
    ADD_LIBRARY(PhysX3Common SHARED ${COMMON_HEADERS} ${COMMON_SOURCES})
ELSE()
    ADD_LIBRARY(PhysX3Common ${COMMON_HEADERS} ${COMMON_SOURCES})
ENDIF()

TARGET_LINK_LIBRARIES(PhysX3Common PUBLIC PxFoundation)