#include <octoon/octoon.h>
#include <octoon/game_object.h>
#include <octoon/game_app.h>
#include <octoon/camera_component.h>
#include <octoon/video_feature.h>

#include "path_meshing_component.h"

const char* chars =
R"({
	"color":[1,0,0],
	"transform":
	{
		"translate":[318.99, 157.10],
		"scale":[1.0, 1.0, 1.0],
		"rotation":[10.0,-10.0,10.0]
	},
	"material":
	{
		"hollow":false,
		"wireframe":false,
		"thickness":10.0,
		"lights":[
			{
				"direcction":[0,1,0],
				"intensity":1.0,
				"ambient":0.0,
				"power":0.6,
				"size":0.9,
				"darkcolor":[0,1,0]
			}
		]
	},
	"boundingBox":
	{
		"min":[0.0,0.0,0.0],
		"max":[420.00,72.00,0.0],
		"center":[0.50, 0.50]
	},
	"text":
	{
		"chars":[
			{
				"paths":
				[
					{ "points":[[43.59,30.94,8],[46.17,33.05,2],[48.52,35.39,2],[53.20,40.08,1],[51.33,41.72,2],[49.92,43.36,2],[48.98,41.95,2],[47.58,40.31,2],[42.19,40.55,2],[37.50,41.02,2],[34.92,45.23,2],[31.88,48.52,2],[31.88,59.06,1],[33.28,58.36,2],[34.80,57.55,2],[36.33,56.72,2],[37.97,55.78,2],[38.44,57.89,2],[39.38,59.77,2],[36.56,61.17,2],[33.28,63.05,2],[30.00,64.92,2],[27.89,66.33,2],[26.95,64.22,2],[25.55,62.34,2],[27.89,61.17,2],[28.13,58.59,2],[28.13,51.56,1],[25.08,54.14,2],[18.52,57.66,2],[17.58,55.55,2],[15.70,53.44,2],[20.16,52.27,2],[24.72,49.22,2],[29.30,46.17,2],[32.58,41.25,2],[27.19,41.95,1],[25.55,42.19,2],[22.73,42.89,2],[22.03,40.55,2],[21.09,38.44,2],[23.91,37.97,2],[27.19,34.58,2],[30.47,31.17,2],[33.98,25.55,2],[35.86,26.72,2],[38.67,28.13,2],[36.80,29.77,2],[33.98,32.70,2],[31.17,35.63,2],[28.13,38.20,2],[36.56,37.97,2],[44.53,37.27,2],[42.66,35.16,2],[40.78,33.52,2],[42.42,32.34,2],[43.59,30.94,2]]},
					{ "points":[[33.28,11.48,8],[35.39,11.25,2],[37.97,10.55,2],[39.61,14.30,2],[40.31,17.58,2],[48.28,17.58,1],[51.56,17.58,2],[56.48,17.34,2],[56.48,21.09,1],[51.56,20.86,2],[48.28,20.86,2],[27.66,20.86,1],[23.44,20.86,2],[18.98,21.09,2],[18.98,17.34,1],[23.20,17.58,2],[27.42,17.58,2],[35.63,17.58,1],[35.16,15.00,2],[33.28,11.48,2]]},
					{ "points":[[55.31,47.58,8],[53.44,48.75,2],[51.09,50.28,2],[48.75,51.80,2],[46.41,53.44,2],[47.34,55.08,2],[50.16,57.19,2],[52.97,59.30,2],[58.13,60.70,2],[56.02,62.34,2],[54.84,64.69,2],[49.45,62.34,2],[46.05,58.95,2],[42.66,55.55,2],[40.55,51.56,2],[38.44,47.58,2],[37.03,43.83,2],[40.31,42.66,1],[42.42,48.28,2],[44.30,50.63,2],[46.64,49.22,2],[48.52,47.58,2],[50.39,45.94,2],[51.80,44.30,2],[53.20,46.17,2],[55.31,47.58,2]]},
					{ "points":[[15.94,45.70,8],[14.77,47.11,2],[11.59,54.50,2],[8.44,61.88,2],[7.03,64.92,2],[5.16,63.28,2],[2.58,61.88,2],[4.92,59.06,2],[7.61,53.67,2],[10.31,48.28,2],[11.95,43.36,2],[13.83,44.77,2],[15.94,45.70,2]]},
					{ "points":[[54.14,33.52,8],[52.03,31.41,2],[49.22,29.19,2],[46.41,26.95,2],[41.72,24.38,2],[43.13,23.20,2],[44.77,21.33,2],[51.33,25.78,1],[54.61,27.89,2],[57.42,30.00,2],[55.31,31.64,2],[54.14,33.52,2]]},
					{ "points":[[16.88,30.94,8],[19.92,29.53,2],[22.97,26.95,2],[26.02,24.38,2],[27.66,21.56,2],[29.53,23.20,2],[31.64,24.84,2],[29.77,26.02,2],[26.83,28.72,2],[23.91,31.41,2],[20.63,33.98,2],[18.98,32.34,2],[16.88,30.94,2]]},
					{ "points":[[5.39,27.66,8],[7.03,28.59,2],[9.61,30.47,2],[12.19,32.34,2],[15.23,34.45,2],[13.13,36.56,2],[11.95,38.67,2],[10.31,36.80,2],[7.84,34.81,2],[5.39,32.81,2],[2.58,30.94,2],[3.98,29.53,2],[5.39,27.66,2]]},
					{ "points":[[13.83,23.91,8],[11.02,21.09,2],[8.78,19.34,2],[6.56,17.58,2],[5.16,16.17,2],[6.80,14.53,2],[7.73,13.13,2],[9.14,14.06,2],[11.48,15.94,2],[13.83,17.81,2],[17.11,20.16,2],[15.47,21.80,2],[13.83,23.91,2]]}
				]
			},
			{
				"paths":
				[
					{ "points":[[103.59,30.94,8],[106.17,33.05,2],[108.52,35.39,2],[113.20,40.08,1],[111.33,41.72,2],[109.92,43.36,2],[108.98,41.95,2],[107.58,40.31,2],[102.19,40.55,2],[97.50,41.02,2],[94.92,45.23,2],[91.88,48.52,2],[91.88,59.06,1],[93.28,58.36,2],[94.80,57.55,2],[96.33,56.72,2],[97.97,55.78,2],[98.44,57.89,2],[99.38,59.77,2],[96.56,61.17,2],[93.28,63.05,2],[90.00,64.92,2],[87.89,66.33,2],[86.95,64.22,2],[85.55,62.34,2],[87.89,61.17,2],[88.13,58.59,2],[88.13,51.56,1],[85.08,54.14,2],[78.52,57.66,2],[77.58,55.55,2],[75.70,53.44,2],[80.16,52.27,2],[84.72,49.22,2],[89.30,46.17,2],[92.58,41.25,2],[87.19,41.95,1],[85.55,42.19,2],[82.73,42.89,2],[82.03,40.55,2],[81.09,38.44,2],[83.91,37.97,2],[87.19,34.58,2],[90.47,31.17,2],[93.98,25.55,2],[95.86,26.72,2],[98.67,28.13,2],[96.80,29.77,2],[93.98,32.70,2],[91.17,35.63,2],[88.13,38.20,2],[96.56,37.97,2],[104.53,37.27,2],[102.66,35.16,2],[100.78,33.52,2],[102.42,32.34,2],[103.59,30.94,2]]},
					{ "points":[[93.28,11.48,8],[95.39,11.25,2],[97.97,10.55,2],[99.61,14.30,2],[100.31,17.58,2],[108.28,17.58,1],[111.56,17.58,2],[116.48,17.34,2],[116.48,21.09,1],[111.56,20.86,2],[108.28,20.86,2],[87.66,20.86,1],[83.44,20.86,2],[78.98,21.09,2],[78.98,17.34,1],[83.20,17.58,2],[87.42,17.58,2],[95.63,17.58,1],[95.16,15.00,2],[93.28,11.48,2]]},
					{ "points":[[115.31,47.58,8],[113.44,48.75,2],[111.09,50.28,2],[108.75,51.80,2],[106.41,53.44,2],[107.34,55.08,2],[110.16,57.19,2],[112.97,59.30,2],[118.13,60.70,2],[116.02,62.34,2],[114.84,64.69,2],[109.45,62.34,2],[106.05,58.95,2],[102.66,55.55,2],[100.55,51.56,2],[98.44,47.58,2],[97.03,43.83,2],[100.31,42.66,1],[102.42,48.28,2],[104.30,50.63,2],[106.64,49.22,2],[108.52,47.58,2],[110.39,45.94,2],[111.80,44.30,2],[113.20,46.17,2],[115.31,47.58,2]]},
					{ "points":[[75.94,45.70,8],[74.77,47.11,2],[71.59,54.50,2],[68.44,61.88,2],[67.03,64.92,2],[65.16,63.28,2],[62.58,61.88,2],[64.92,59.06,2],[67.61,53.67,2],[70.31,48.28,2],[71.95,43.36,2],[73.83,44.77,2],[75.94,45.70,2]]},
					{ "points":[[114.14,33.52,8],[112.03,31.41,2],[109.22,29.19,2],[106.41,26.95,2],[101.72,24.38,2],[103.13,23.20,2],[104.77,21.33,2],[111.33,25.78,1],[114.61,27.89,2],[117.42,30.00,2],[115.31,31.64,2],[114.14,33.52,2]]},
					{ "points":[[76.88,30.94,8],[79.92,29.53,2],[82.97,26.95,2],[86.02,24.38,2],[87.66,21.56,2],[89.53,23.20,2],[91.64,24.84,2],[89.77,26.02,2],[86.83,28.72,2],[83.91,31.41,2],[80.63,33.98,2],[78.98,32.34,2],[76.88,30.94,2]]},
					{ "points":[[65.39,27.66,8],[67.03,28.59,2],[69.61,30.47,2],[72.19,32.34,2],[75.23,34.45,2],[73.13,36.56,2],[71.95,38.67,2],[70.31,36.80,2],[67.84,34.81,2],[65.39,32.81,2],[62.58,30.94,2],[63.98,29.53,2],[65.39,27.66,2]]},
					{ "points":[[73.83,23.91,8],[71.02,21.09,2],[68.78,19.34,2],[66.56,17.58,2],[65.16,16.17,2],[66.80,14.53,2],[67.73,13.13,2],[69.14,14.06,2],[71.48,15.94,2],[73.83,17.81,2],[77.11,20.16,2],[75.47,21.80,2],[73.83,23.91,2]]}
				]
			},
			{
				"paths":
				[
					{ "points":[[136.41,33.75,8],[136.41,18.28,1],[136.41,16.17,2],[136.17,12.19,2],[141.33,12.19,1],[141.09,16.64,2],[141.09,18.05,2],[141.09,33.75,1],[169.45,33.75,1],[172.50,33.75,2],[176.02,33.52,2],[176.02,38.20,1],[171.56,37.97,2],[167.81,37.97,2],[154.22,37.97,1],[155.86,42.66,2],[159.25,47.11,2],[162.66,51.56,2],[167.34,54.50,2],[172.03,57.42,2],[175.78,58.59,2],[172.73,60.47,2],[171.09,63.28,2],[166.17,60.70,2],[161.95,57.19,2],[157.73,53.67,2],[154.45,48.64,2],[151.17,43.59,2],[149.53,37.97,2],[141.09,37.97,1],[141.09,56.48,1],[147.89,52.27,2],[150.23,50.16,2],[151.88,52.73,2],[153.52,54.84,2],[149.06,56.95,2],[144.61,60.11,2],[140.16,63.28,2],[138.05,65.39,2],[136.17,62.81,2],[134.53,60.94,2],[136.41,59.06,2],[136.41,56.02,2],[136.41,37.97,1],[131.02,37.97,1],[127.73,37.97,2],[123.52,38.20,2],[123.52,33.52,1],[127.73,33.75,2],[130.55,33.75,2],[136.41,33.75,1]]},
					{ "points":[[165.94,15.94,8],[163.36,18.05,2],[158.31,23.09,2],[153.28,28.13,2],[148.36,32.81,2],[146.25,30.00,2],[144.84,29.06,2],[148.83,26.25,2],[153.75,21.09,2],[158.67,15.94,2],[161.25,12.19,2],[163.13,13.83,2],[165.94,15.94,2]]}
				]
			},
			{
				"paths":
				[
					{ "points":[[223.13,17.11,8],[228.28,17.11,2],[233.67,16.64,2],[233.67,21.80,1],[228.28,21.56,2],[223.59,21.56,2],[219.61,21.56,1],[219.61,57.66,1],[225.00,57.66,1],[230.39,57.66,2],[236.72,57.42,2],[236.72,62.34,1],[230.39,62.11,2],[225.00,62.11,2],[210.23,62.11,1],[204.84,62.11,2],[198.05,62.34,2],[198.05,57.42,1],[204.84,57.66,2],[210.23,57.66,2],[214.69,57.66,1],[214.69,21.56,1],[212.11,21.56,1],[206.95,21.56,2],[201.33,21.80,2],[201.33,16.88,1],[207.19,17.11,2],[212.11,17.11,2],[223.13,17.11,1]]},
					{ "points":[[199.45,45.23,8],[197.11,47.58,2],[194.30,54.38,2],[191.48,61.17,2],[189.84,65.86,2],[187.03,64.22,2],[183.28,62.81,2],[185.86,60.23,2],[189.25,53.33,2],[192.66,46.41,2],[193.83,42.42,2],[196.64,44.30,2],[199.45,45.23,2]]},
					{ "points":[[184.45,28.36,8],[190.31,30.70,2],[195.47,33.75,2],[193.59,35.63,2],[192.66,38.67,2],[187.73,35.16,2],[182.11,32.81,2],[183.52,30.47,2],[184.45,28.36,2]]},
					{ "points":[[189.14,12.89,8],[194.53,15.94,2],[199.22,19.22,2],[197.34,21.33,2],[195.94,23.67,2],[191.02,19.45,2],[186.56,16.88,2],[187.73,15.47,2],[189.14,12.89,2]]}
				]
			},
			{
				"paths":
				[
					{ "points":[[261.09,21.56,8],[264.84,14.77,2],[266.02,10.78,2],[271.41,13.13,1],[269.53,15.47,2],[266.25,21.56,2],[282.66,21.56,1],[287.81,21.56,2],[292.73,21.33,2],[292.73,25.78,1],[289.45,25.55,2],[285.94,25.55,2],[264.61,25.55,1],[261.33,30.70,2],[255.70,38.44,2],[269.53,38.44,1],[269.53,33.75,2],[269.30,29.53,2],[274.69,29.53,1],[274.45,32.11,2],[274.45,38.44,2],[283.59,38.44,1],[287.58,38.44,2],[292.03,38.20,2],[292.03,42.42,1],[288.28,42.19,2],[283.83,42.19,2],[274.45,42.19,1],[274.45,59.30,1],[274.45,63.05,2],[271.64,64.09,2],[268.83,65.16,2],[264.38,65.86,2],[263.67,62.81,2],[261.80,60.47,2],[266.95,60.47,2],[268.23,60.00,2],[269.53,59.53,2],[269.53,56.72,2],[269.53,42.19,1],[259.22,42.19,1],[253.59,42.19,2],[249.84,42.89,2],[249.14,40.55,2],[247.97,38.20,2],[250.55,37.27,2],[253.13,34.11,2],[255.70,30.94,2],[258.98,25.55,2],[252.42,25.55,1],[248.44,25.55,2],[246.33,25.78,2],[246.33,21.33,1],[248.20,21.56,2],[251.72,21.56,2],[261.09,21.56,1]]},
					{ "points":[[256.17,56.02,8],[252.19,60.00,2],[248.44,63.98,2],[247.03,62.11,2],[244.69,60.47,2],[253.83,52.50,2],[257.34,46.41,2],[258.98,48.28,2],[262.03,50.16,2],[256.17,56.02,1]]},
					{ "points":[[283.36,46.88,8],[285.70,48.98,2],[289.45,52.50,2],[293.20,56.02,2],[296.02,59.06,2],[295.08,59.77,2],[291.80,62.81,2],[288.28,58.36,2],[279.84,50.39,2],[282.42,48.28,2],[283.36,46.88,2]]}
				]
			},
			{
				"paths":
				[
					{ "points":[[356.02,16.17,8],[352.73,16.41,2],[348.75,16.88,2],[344.77,17.34,2],[340.31,17.58,2],[340.31,26.72,1],[350.16,26.72,1],[352.50,26.72,2],[356.72,26.25,2],[356.72,30.70,1],[353.20,30.47,2],[350.39,30.47,2],[350.39,49.92,1],[350.39,52.97,2],[350.63,56.48,2],[345.94,56.48,1],[346.17,52.97,2],[346.17,49.92,2],[346.17,30.47,1],[340.31,30.47,1],[340.08,38.44,2],[339.02,44.06,2],[337.97,49.69,2],[334.22,56.72,2],[332.58,55.08,2],[329.77,54.14,2],[333.52,48.52,2],[334.69,42.89,2],[335.86,37.27,2],[336.09,30.36,2],[336.33,23.44,2],[335.86,13.36,2],[339.84,13.59,2],[345.11,13.02,2],[350.39,12.42,2],[353.20,11.25,2],[356.02,16.17,1]]},
					{ "points":[[313.83,30.47,8],[313.59,35.16,2],[313.59,39.14,2],[313.59,53.91,1],[321.33,60.23,2],[335.03,60.11,2],[348.75,60.00,2],[357.89,59.06,2],[356.25,61.88,2],[356.02,64.45,2],[345.94,64.69,2],[339.61,64.69,2],[333.28,64.69,2],[328.83,64.33,2],[324.38,63.98,2],[321.20,62.81,2],[318.05,61.64,2],[315.34,59.77,2],[312.66,57.89,2],[310.31,60.00,2],[307.97,62.11,2],[305.86,65.39,2],[304.22,63.52,2],[301.88,62.11,2],[304.22,59.77,2],[309.38,54.84,2],[309.38,34.45,1],[306.33,34.45,2],[303.05,34.69,2],[303.05,30.23,1],[306.33,30.47,2],[308.91,30.47,2],[313.83,30.47,1]]},
					{ "points":[[324.14,22.03,8],[324.14,14.77,2],[323.91,11.02,2],[328.83,11.02,1],[328.36,13.83,2],[328.36,22.03,2],[330.47,22.03,2],[333.52,21.80,2],[333.52,26.02,1],[330.47,25.78,2],[328.36,25.78,2],[328.36,33.52,1],[330.23,32.34,2],[332.81,30.94,2],[332.81,33.52,2],[333.28,35.39,2],[330.94,36.33,2],[328.36,37.73,2],[328.36,48.98,1],[328.36,51.80,2],[326.95,52.86,2],[325.55,53.91,2],[320.86,54.84,2],[320.63,52.73,2],[318.52,49.45,2],[323.67,49.92,2],[324.14,48.28,2],[324.14,39.61,1],[321.56,40.55,2],[318.75,42.42,2],[318.05,40.31,2],[316.64,37.50,2],[319.69,36.80,2],[324.14,34.92,2],[324.14,25.78,1],[319.92,25.78,2],[316.88,26.02,2],[316.88,21.80,1],[319.92,22.03,2],[324.14,22.03,2]]},
					{ "points":[[310.55,13.36,8],[312.89,19.45,2],[314.30,23.91,2],[311.72,24.61,2],[309.38,25.55,2],[307.97,19.92,2],[306.09,15.00,2],[308.44,14.30,2],[310.55,13.36,2]]}
				]
			},
			{
				"paths":
				[
					{ "points":[[392.34,11.48,8],[392.34,15.00,2],[392.22,17.81,2],[392.11,20.63,2],[392.69,24.73,2],[393.28,28.83,2],[397.03,34.45,2],[406.64,26.48,2],[408.52,22.03,2],[411.09,24.38,2],[413.20,26.48,2],[410.16,28.59,2],[407.22,31.17,2],[404.30,33.75,2],[399.14,38.20,2],[401.02,42.19,2],[405.94,47.11,2],[410.86,52.03,2],[417.89,54.14,2],[413.91,56.02,2],[413.20,58.83,2],[404.30,53.44,2],[399.48,46.88,2],[394.69,40.31,2],[392.11,33.75,2],[392.11,59.77,1],[392.34,63.05,2],[389.64,64.45,2],[386.95,65.86,2],[382.50,66.33,2],[382.27,63.75,2],[380.39,60.70,2],[384.14,61.41,2],[385.78,60.94,2],[387.42,60.47,2],[387.42,57.89,2],[387.42,20.86,1],[387.42,15.00,2],[386.95,11.48,2],[392.34,11.48,1]]},
					{ "points":[[383.91,26.48,8],[382.73,32.81,2],[380.97,37.86,2],[379.22,42.89,2],[376.28,47.81,2],[373.36,52.73,2],[367.03,59.06,2],[365.39,56.95,2],[362.11,55.78,2],[368.67,51.09,2],[372.53,45.00,2],[376.41,38.91,2],[378.28,30.70,2],[371.95,30.70,1],[368.44,30.70,2],[363.98,31.17,2],[363.98,26.25,1],[368.20,26.48,2],[371.72,26.48,2],[383.91,26.48,1]]}
				]
			}
		]
	},
	"canvas":
	{
		"width":1376,
		"height":768
	}
})";

int main(int argc, const char* argv[])
{
#if _WINDOWS
	char drive[MAX_PATH];
	char dir[MAX_PATH];
	char filename[MAX_PATH];
	char ext[MAX_PATH];
	_splitpath(argv[0], drive, dir, filename, ext);

	std::string root;
	root += drive;
	root += dir;

	::SetCurrentDirectory(root.c_str());
#endif

	int w = 1920, h = 1080;

	auto app = octoon::GameApp::instance();
	app->open(nullptr, w, h, w, h);
	app->start();

	auto camera = std::make_shared<octoon::GameObject>();
	camera->addComponent<octoon::CameraComponent>();
	camera->getComponent<octoon::CameraComponent>()->setCameraOrder(octoon::video::CameraOrder::Main);
	camera->getComponent<octoon::CameraComponent>()->setCameraType(octoon::video::CameraType::Ortho);
	camera->getComponent<octoon::CameraComponent>()->setOrtho(octoon::math::float4(0.0, 1.0, 0.0, 1.0));
	camera->getComponent<octoon::CameraComponent>()->setClearColor(octoon::math::float4(1.0, 1.0, 1.0, 0.0));

	auto object = std::make_shared<octoon::GameObject>();
	object->addComponent<PathMeshingComponent>(chars);

	app->update();
	app->getFeature<octoon::VideoFeature>()->saveAsPNG("C:/Users/Administrator/Desktop/output.png", 0, 0, w, h);
}